<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
</head>

<body>
    <div class="container">
        <div class="topic-area">
            <h1>{{ title }}</h1>
            <p>ã“ã“ã«ãŠé¡Œæ–‡ãŒå…¥ã‚Šã¾ã™</p>
        </div>

        <div class="reaction-area">
            <div class="buttons">

                <div class="reaction-item" data-emoji="ğŸ‘">
                <div class="stack"></div>
                <button onclick="sendReaction('ğŸ‘')">ğŸ‘</button>
                </div>
                <div class="reaction-item" data-emoji="ğŸ˜‚">
                <div class="stack"></div>
                <button onclick="sendReaction('ğŸ˜‚')">ğŸ˜‚</button>
                </div>
                <div class="reaction-item" data-emoji="â¤ï¸">
                <div class="stack"></div>
                <button onclick="sendReaction('â¤ï¸')">â¤ï¸</button>
                </div>
                <div class="reaction-item" data-emoji="ğŸ˜¡">
                <div class="stack"></div>
                <button onclick="sendReaction('ğŸ˜¡')">ğŸ˜¡</button>
                </div>
                <div class="reaction-item" data-emoji="ğŸ˜">
                <div class="stack"></div>
                <button onclick="sendReaction('ğŸ˜')">ğŸ˜</button>
                </div>
                <div class="reaction-item" data-emoji="ğŸ™…â€â™€ï¸">
                <div class="stack"></div>
                <button onclick="sendReaction('ğŸ™…â€â™€ï¸')">ğŸ™…â€â™€ï¸</button>
                <div id="reaction-log"></div>
                </div>
            </div>
        </div>
    </div>
</body>

<style>
/*ç©ºç™½ã®éš™é–“ã‚’ãªãã™*/
body {
    margin: 0;
}

.container {
    height: 100vh;
    display: flex;
    flex-direction: column;
}

/* ä¸Šï¼šãŠé¡Œã‚¨ãƒªã‚¢ï¼ˆ60%ï¼‰ */
.topic-area {
    flex: 6;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* ä¸‹ï¼šãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ï¼ˆ40%ï¼‰ */
.reaction-area {
    flex: 4;
    display: flex;
    justify-content: center;
    align-items: center;
}

.buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
}

.buttons button {
    font-size: 2rem;
    padding: 12px 16px;
}

.reaction-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stack {
    min-height: 60px;
    display: flex;
    flex-direction: column-reverse;
    gap: 2px;
}

.stack span {
    font-size: 1.2rem;
}
</style>

    <script>
    function sendReaction(emoji) {
        fetch('/api/reaction', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                emoji: emoji
            })
        });
    }

    function updateStacks(summary) {
    summary.forEach(item => {
    const box = document.querySelector(
    `.reaction-item[data-emoji="${item.emoji}"]`
    );
    if (!box) return;

    const stack = box.querySelector('.stack');
    stack.innerHTML = '';

    // è¡¨ç¤ºæ•°ã¯å¤šãã¦ã‚‚OKï¼ˆä¾‹ï¼š20ï¼‰
    const maxDisplay = Math.min(item.count, 20);

    for (let i = 0; i < maxDisplay; i++) {
    const span = document.createElement('span');
    span.textContent = item.emoji;
    stack.appendChild(span);
    }

    // ã‚‚ã—å¤šã™ããŸã‚‰ã€Œ+â—‹ã€è¡¨ç¤º
    if (item.count > maxDisplay) {
    const more = document.createElement('div');
    more.textContent = `+${item.count - maxDisplay}`;
    more.style.fontSize = '0.8rem';
    stack.appendChild(more);
    }
});
}

async function fetchReactions() {
const res = await fetch('/api/reaction/summary');
const summary = await res.json();

updateStacks(summary);
}

            


    // 1ç§’ã”ã¨ã«æœ€æ–°å–å¾—
    setInterval(fetchReactions, 100);

    // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚å–å¾—
    window.onload = fetchReactions;

</script>
</body>

</html>